{"name":"Puppet-centos","tagline":"Puppet Centos 6 installation","body":"#Установка Puppet-клиентов #\r\n\r\n\r\n1.Необходимо привести в следующий вид файл /etc/hosts:\r\n\r\n\t\t###############################################################################\r\n\t\t127.0.0.1        agent02.com\r\n\t\t192.168.0.105 agent02.com # NIC <eth2>\r\n\r\n\t\t#puppet-master\r\n\t\t10.10.69.47        server.com\r\n\t\t###############################################################################\r\n\r\n2.Первое конечно установить puppet:\r\n\t\t\r\n        yum install puppet -y\r\n\r\n3.Затем в конф /etc/puppet/puppet.conf в секцию [agent] добавить следующие строки:\r\n\t\t\r\n        server = server.com\r\n        report = true\r\n4.Думаю что здесь все понятно.\r\n\r\n\r\n#Установка Puppet Server\r\n\r\n1.Необходимо привести в следующий вид файл /etc/hosts:\r\n\r\n        ###############################################################################\r\n        127.0.0.1 server.com server localhost\r\n        10.10.69.47 server.com # NIC <eth2>\r\n        192.168.0.101 server.com # NIC <eth3>\r\n        192.168.0.104        agent01.com\r\n        192.168.0.105        agent02.com\r\n        192.168.0.106        alone.com\r\n        ###############################################################################\r\n\r\n2.Подключаем репозиторий puppet-labs:\r\n\r\n\t\t[root@server]# rpm -ihv http://yum.puppetlabs.com/el/6/products/x86_64/puppetlabs-release-6-7.noarch.rpm\r\n\r\n3.Устанавливаем пакет для сервера:\r\n\r\n\t\t[root@server]# yum install puppet-server readline-devel -y\r\n\r\n4.Настроить на сервере /etc/hosts\r\n\r\n\t\t[root@server]# echo -e \"[master]\\nreports = store,\\nhttp\\nreporturl = http://localhost:3000/reports/upload\\n\" >> /etc/puppet/puppet.conf\r\n\r\n\r\n5.Открыть порт 8140 на сервере.\r\n\r\n6.После перезапуска агента сервер уже видит его запрос.\r\n\r\n\t\t[root@server]# puppet cert --list --all\r\n\r\n7.И можно сразу подписать ( у подписанной ноды стоит знак \"+\" слева ):\r\n\t\r\n\t\t[root@server]# puppet cert sign <host>\r\n\t\t# Например >puppet cert sign agent.сom\r\n\r\n8.Ноды описываются на сервере в файле /etc/puppet/manifests/nodes.pp\r\n\t\r\n\tПримерно так:\r\n\t\t\r\n\t\t[root@server]# cat nodes.pp\r\n \t\t\t\t\t   node 'agent01.com' {\r\n   \t\t\t\t\t\t\t\tinclude httpd\r\n\t\t\t\t\t\t\t}\r\n\r\n \t\t\t\t\t   node 'agent02.com' {\r\n   \t\t\t\t\t\t\t\tinclude httpd\r\n\t\t\t\t\t\t\t}\r\n9.Рецепты:\r\n\r\n\t\t[root@server]# cat /etc/puppet/manifests/site.pp\r\n\t\t\t\t\t\tclass httpd {\r\n   \t\t\t\t\t\t\t\t\t\tpackage { 'httpd':\r\n   \t\t\t\t\t\t\t\t\t\t\t\tensure => installed,\r\n   \t\t\t\t\t\t\t\t\t\t\t\t}\r\n   \t\t\t\t\t\t\t\t\t\tservice { 'httpd':\r\n   \t\t\t\t\t\t\t\t\t\t\t\tensure => true,\r\n   \t\t\t\t\t\t\t\t\t\t\t\tenable => true,\r\n   \t\t\t\t\t\t\t\t\t\t\t\trequire => Package['httpd'],\r\n  \t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t \t}\r\n\r\n\r\n# Установка Puppet-dashboard #\r\n\r\n\t    yum install puppet-dashboard\r\n\r\n\t    Dependencies Resolved\r\n\r\n\t    =========================================================================================== \t    Package Arch Version Repository Size\r\n\t    ===========================================================================================\t    Installing:\r\n \t    puppet-dashboard noarch 1.2.23-1.el6 puppetlabs-products 4.3 M\r\n\t    Installing for dependencies:\r\n \t    ruby-mysql x86_64 2.8.2-1.el6 epel 45 k\r\n \t    rubygem-rake noarch 0.8.7-2.1.el6 base 404 k\r\n\r\n\t    Transaction Summary\r\n\t    ===========================================================================================\t    Install 3 Package(s)\r\n\r\n\t     Total download size: 4.7 M\r\n\t     Installed size: 18 M\r\n\r\n\r\n   \r\n1.Установка MySQL-server\r\n\t\t\t\r\n\t\tyum install mysql-server mysql mysql-devel readline-devel -y\r\n\t\t/etc/init.d/mysqld start\r\n\t\t/sbin/chkconfig mysqld on\r\n\t\tmysql_secure_installation\r\n\t\tyum install ruby-devel\r\n\t\tgem install rake mysql\r\n\r\n2.Настройка подключения к БД ( puppet ) config/database.yml:\r\n\r\n\t\tmysql>\tCREATE DATABASE dashboard CHARACTER SET utf8;\r\n\t\t\tCREATE USER 'dashboard'@'localhost' IDENTIFIED BY 'my_password';\r\n\t\t\tGRANT ALL PRIVILEGES ON dashboard.* TO 'dashboard'@'localhost';\r\n\t\t\tflush privileges;\r\n\r\n3.Установить пераметр для MySQL:\r\n\t\t\r\n\t\tmysql> set max_allowed_packet = 33554432;\r\n или\r\n\r\n\t\tmax_allowed_packet = 32M в /etc/my.cnf\r\n\t\tservice mysqld restart\r\n\r\n4.Переходим в папку с pappet-dashboard где находится скирпт импорта таблиц и запускаем:\r\n\r\n\t\tcd /usr/share/puppet-dashboard/\r\n\t\trake gems:refresh_specs\r\n\t\trake RAILS_ENV=production db:migrate\r\n\r\n\t\t/etc/init.d/puppet-dashboard start\r\n\t\tusermod -aG puppet puppet-dashboard\r\n\t\tchown -R puppet-dashboard:puppet-dashboard /usr/share/puppet-dashboard/\r\n\t\tsudo -u puppet-dashboard rake RAILS_ENV=production reports:import\r\n\r\n5.И наконец после этой комманды отображается нода в дашборде:\r\n\t\t\r\n\t\tsudo -u puppet-dashboard env RAILS_ENV=production script/delayed_job -p dashboard -n 4 -m start\r\n\r\n\r\n\r\n6.Установка Apache\r\n\t\r\n\t\tyum install httpd mod_ssl httpd-devel\r\n\t\t/sbin/chkconfig httpd on\r\n\t\t/etc/init.d/httpd start\r\n\r\n7.Установка модуля passenger для Апача\r\n\t\r\n\t\tyum install curl-devel -y\r\n\t\tgem update\r\n\t\tgem install passenger\r\n\t\tpassenger-install-apache2-module\r\n\r\n8.Жмак на энтер, много-много букоф... чувствую себя хацкером :Ъ\r\n\r\n9.Добавляем в /etc/httpd/conf/httpd.conf ( у нас уже с руби 1.9.3 ) :\r\n\r\n\t\tnano /etc/httpd/conf/httpd.conf\r\n\t\tLoadModule passenger_module /usr/local/rvm/gems/ruby-1.9.3-p448/gems/passenger-4.0.21/buildout/apache2/mod_passenger.so\r\n   \t\tPassengerRoot /usr/local/rvm/gems/ruby-1.9.3-p448/gems/passenger-4.0.21\r\n   \t\tPassengerDefaultRuby /usr/local/rvm/wrappers/ruby-1.9.3-p448/ruby\r\n\r\n10.Виртуальный хост:\r\n\t\t \r\n\t\t<VirtualHost *:80>\r\n   \t\t\tServerName server.com\r\n  \t\t\t\t# !!! Be sure to point DocumentRoot to 'public'!\r\n   \t\t\t\tDocumentRoot /usr/share/puppet-dashboard/public\r\n   \t\t\t\t<Directory /usr/share/puppet-dashboard/public>\r\n   \t\t\t\t# This relaxes Apache security settings.\r\n   \t\t\t\t\tAllowOverride all\r\n   \t\t\t\t\t# MultiViews must be turned off.\r\n   \t\t\t\t\tOptions -MultiViews\r\n   \t\t\t\t</Directory>\r\n   \t\t</VirtualHost>\r\n\r\n11.Меняем пользователя с apache на puppet-dashboard\r\n\t\t\r\n\t\tsed -i 's/User apache/User puppet-dashboard/g' /etc/httpd/conf/httpd.conf\r\n\t\tsed -i 's/Group apache/Group puppet-dashboard/g' /etc/httpd/conf/httpd.conf\r\n\r\n12.Перезагружаем сервер.\r\n\r\n\t\tservice httpd restart\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}